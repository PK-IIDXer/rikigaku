\chapter{微分の基礎}

せっかく微分がでてきたので、数学的にしっかり基礎づけしていきましょう。



\section{定義のおさらい}

\begin{definition}
  $I$を区間、$f:I\to\mathbb{R}$を(連続とは限らない)関数、$x\in I$とする。
  このとき、極限
  \[
    f'(x):=\lim_{y\to x}\frac{f(x)-f(y)}{x-y}
  \]
  が存在するとき、$f'(x)$を$f$の$x$における\textbf{微分係数}、あるいは単に\textbf{微分}という。
\end{definition}

\begin{definition}
  $I$を区間、$f:I\to\mathbb{R}$を(連続とは限らない)関数とする。
  \textbf{$I$上微分可能である}とは、任意の$x\in I$に対して、微分係数$f'(x)$が存在する時を言う。
  このとき、関数
  \[
    f':I\to\mathbb{R}
  \]
  を、$f$の\textbf{導関数}、あるいは単に\textbf{微分}という。
\end{definition}

$y\to x$を、$y=x+h$の変数変換によって
\[
  f'(x)=\lim_{h\to0}\frac{f(x+h)-f(x)}{h}
\]
と書き換えることも多いし、なんなら高校の教科書での定義はこっちですね。



\section{例題集}

\subsection{べき関数}

まずは簡単なところから行きましょう。
$n>0$を整数として、
\[
  f(x)=x^n
\]
を微分してゆきましょう。
このとき
\[
  \frac{(x+h)^n-x^n}{h}=nx^{n-1}+\frac{n(n-1)}{2}hx^{n-2}+\cdots+h^{n-1}\to nx^{n-1}\quad\text{as }h\to 0
\]
ゆえに
\[
  (x^n)'=nx^{n-1}
\]
です。



\section{微分の性質}

\subsection{微分可能ならば連続}

\begin{theorem}
  $I$を区間、$f:I\to\mathbb{R}$を$I$上微分可能な関数とする。
  このとき、$f$は$I$上連続である。
\end{theorem}
\begin{proof}
  任意の$a\in I$と、十分0に近い$h\neq0$に対して、
  \[
    f(a+h)-f(a)=\frac{f(a+h)-f(a)}{h}\cdot h\to f'(a)\cdot\lim_{h\to0}h=0
  \]
  ゆえに$f$は連続。
\end{proof}

\subsection{線形性}

\begin{theorem}
  $I$を区間、$f,g:I\to\mathbb{R}$を$I$上微分可能な関数、$a,b\in\mathbb{R}$とする。
  このとき、関数
  \[
    af+bg:I\to\mathbb{R};x\mapsto af(x)+bg(x)
  \]
  も$I$上可微分であり、
  \[
    (af+bg)'(x)=af'(x)+bg'(x)
  \]
  が成り立つ。
\end{theorem}
\begin{proof}
  任意の$x\in I$と十分0に近い$h$に対して、
  \begin{align*}
    &\frac{\{af(x+h)+bg(x+h)\}-\{af(x)+bg(x)\}}{h}\\
    =&a\frac{f(x+h)-f(x)}{h}+b\frac{g(x+h)-g(x)}{h}\\
    \to&af'(x)+bg'(x)
  \end{align*}
\end{proof}

この定理を大学１年生に「線形性」といってもピンとこないと思います。
一応もっと踏み込んで解説しましょう。
区間$I$に対して、
\begin{align*}
  C^1(I)&:=\{f:I\to\mathbb{R}\mid\text{$f$は$I$上微分可能であり、$f'$は$I$上連続}\}\\
  C^0(I)&:=\{f:I\to\mathbb{R}\mid\text{$f$は$I$上連続}\}
\end{align*}
と定義すると、$C^0(I)$は体$\mathbb{R}$上のベクトル空間になっています。
また定理から、$C^1(I)$も体$\mathbb{R}$上のベクトル空間になっており、写像
\[
  \frac{d}{dx}:C^1(I)\to C^0(I);f\mapsto\frac{df}{dx}
\]
が線形写像になっている、というわけです。
もちろん$C^1(I)$や$C^0(I)$なんて無限次元ベクトル空間ですから、線形写像$d/dx$を表現する行列なんて分かりっこないです。
でもそういう行列なしに、固有値や固有ベクトルを求めてやったりすることができます。
これが線形代数という抽象化の力です。

ちなみに
\begin{definition}
  $I$を区間、$f:I\to\mathbb{R}$を関数、$r\geq0$を整数とする。
  このとき、$f$が$I$上$r$回微分可能かつ、$r$回目の導関数
  \[
    f^{(r)}(x):=(f^{(r-1)})'(x)
  \]
  が連続であるとき、\textbf{$f$は$I$上$C^r$級関数である}という。
  $I$上$C^r$級である関数全体がなす$\mathbb{R}$ベクトル空間を
  \[
    C^r(I)
  \]
  で表す。
\end{definition}
$r$回微分もいくつか記法があって、
\[
  f^{(r)}(x)=\frac{d^rf}{dx^r}=D_x^rf
\]
などがあります。

\begin{example}
  多項式関数
  \[
    f(x)=a_0x^n+a_1x^{n-1}+\cdots+a_n\in\mathbb{R}[x]
  \]
  は、$\mathbb{R}$上微分可能であり、
  \[
    f'(x)=na_0x^{n-1}+(n-1)a_1x^{n-2}+\cdots+a_1
  \]
  が成り立つ。
\end{example}

\subsection{積の微分}

\begin{theorem}
  $I$を区間、$f,g:I\to\mathbb{R}$を$I$上微分可能な関数とする。
  このとき、関数
  \[
    fg:I\to\mathbb{R};x\mapsto f(x)g(x)
  \]
  も$I$上可微分であり、
  \[
    (fg)'(x)=f'(x)g(x)+f(x)g'(x)
  \]
  がなりたつ。
\end{theorem}
\begin{proof}
  任意の$x\in I$と十分0に近い$h$に対して、
  \begin{align*}
    &\frac{f(x+h)g(x+h)-f(x)g(x)}{h}\\
    =&\frac{f(x+h)g(x+h)-f(x+h)g(x)+f(x+h)g(x)-f(x)g(x)}{h}\\
    =&f(x+h)\frac{g(x+h)-g(x)}{h}+\frac{f(x+h)-f(x)}{h}g(x)\\
    \to&f(x)g'(x)+f'(x)g(x)
  \end{align*}
  (最後に可微分関数の連続性を使用しています)
\end{proof}

\subsection{商の微分}

\begin{theorem}
  $I$を区間、$f:I\to\mathbb{R}$を$I$上微分可能かつ、$f(x)\neq0$ (${}^\forall x\in I$)をみたす関数とする。
  このとき、
  \[
    \frac{1}{f}:I\to\mathbb{R};x\mapsto\frac{1}{f(x)}
  \]
  もまた$I$上微分可能であり、
  \[
    \left(\frac{1}{f}\right)'(x)=-\frac{f'(x)}{f(x)^2}
  \]
  が成り立つ。
\end{theorem}
\begin{proof}
  任意の$x\in I$と十分0に近い$h$に対して、
  \begin{align*}
    &\frac{1/f(x+h)-1/f(x)}{h}\\
    =&-\frac{1}{f(x)f(x+h)}\frac{f(x+h)-f(x)}{h}\\
    \to&-\frac{f'(x)}{f(x)^2}
  \end{align*}
\end{proof}

\begin{example}
  $f,g$を$I$上微分可能な関数で、$g$は$I$上0にならないとする。
  このとき、積の微分と商の微分から
  \[
    \frac{f}{g}:I\to\mathbb{R}
  \]
  も$I$上可微分関数であり、
  \[
    \left(\frac{f}{g}\right)'(x)=f'(x)\frac{1}{g(x)}+f(x)\left(\frac{1}{g}\right)'(x)=\frac{f'(x)}{g(x)}-\frac{f(x)g'(x)}{g(x)^2}=\frac{f'(x)g(x)-f(x)g'(x)}{g(x)^2}
  \]
\end{example}

\begin{example}
  $x\neq0$に対して
  \[
    (x^{-1})'=\frac{(x)'}{x^2}=-\frac{1}{x^2}=-x^{-2}
  \]

  一般に、任意の整数$n>0$について
  \[
    (x^{-n})'=-nx^{-n-1}
  \]
  であることが帰納法により次のように示せる。
  仮に$(x^{-n+1})'=(-n+1)x^{-n}$が成り立つとすると、
  \[
    (x^{-n})'=(x^{-1}\cdot x^{-n+1})'=-x^{-2}\cdot x^{-n+1}+x^{-1}\cdot(-n+1)x^{-n}=-nx^{-n-1}
  \]

  ゆえに一般の整数$n\in\mathbb{Z}$に対して、
  \[
    (x^n)'=nx^{n-1}
  \]
  が成り立つ。
\end{example}



\section{平均値の定理}\label{sec:mean-value-theorem}

力学で運動の等速直線運動を調べるために平均値の定理が出てきたので、ここで証明しましょう。
また、次に紹介する合成関数の微分公式の証明にも使います。

まず補題として、ロルの定理を証明します。
\begin{theorem}[ロルの定理]
  $a,b\in\mathbb{R}$、$a<b$とする。
  連続写像$f:[a,b]\to\mathbb{R}$が開区間$(a,b)$で微分可能であり、かつ$f(a)=f(b)$とする。
  このとき、ある$c\in(a,b)$が存在して、$f'(c)=0$を満たす。
\end{theorem}
\begin{proof}
  閉区間$[a,b]$はコンパクトだから、最大値最小値の定理より、値域には最大値$M$と最小値$m$が存在する。
  もし$m=M$であれば、$f$は定値関数だから定理は自明。
  ゆえに$m<M$であるとしてよい。
  このとき$m<f(a)=f(b)$または$f(a)=f(b)<M$である。
  ここでは$f(a)=f(b)<M$の場合を証明する($m<f(a)=f(b)$の場合も同様)。

  $M=f(c)$となる$c\in(a,b)$をとる。
  このとき、$f'(c)=0$を証明する。
  仮に$L:=f'(c)>0$であるとすると、$f$は$c\in(a,b)$で微分可能なので、$\varepsilon:=L/2>0$に対して、ある$\delta>0$が存在して、
  \[
    0<|x-c|<\delta\Rightarrow\left|\frac{f(x)-f(c)}{x-c}-L\right|<\frac{L}{2}
  \]
  よって$0<|x-c|<\delta$のとき、
  \begin{align*}
    &-\frac{L}{2}<\frac{f(x)-f(c)}{x-c}-L<\frac{L}{2}\\
    \iff&\frac{L}{2}<\frac{f(x)-f(c)}{x-c}<\frac{3L}{2}
  \end{align*}
  $x$として$0<x-c<\delta$を満たすように取っておけば、上記の不等式の辺々に$x-c$をかけることで
  \[
    f(x)-f(c)>\frac{L}{2}(x-c)>0
  \]
  ゆえに$f(x)>f(c)=M$となり、$M$が最大値であったことに矛盾。

  もし$L:=f'(c)<0$のときは、$\varepsilon:=-L/2>0$に対して、ある$\delta'>0$が存在して、
  \[
    0<|x-c|<\delta'\Rightarrow\left|\frac{f(x)-f(c)}{x-c}-L\right|<-\frac{L}{2}
  \]
  より、$0<|x-c|<\delta$のとき、
  \begin{align*}
    &\frac{L}{2}<\frac{f(x)-f(c)}{x-c}-L<-\frac{L}{2}\\
    \iff&\frac{3L}{2}<\frac{f(x)-f(c)}{x-c}<\frac{L}{2}\\
    \therefore\;0>x-c>-\delta'\Rightarrow& f(x)-f(c)>\frac{L}{2}(x-c)>0
  \end{align*}
  より$f(x)>f(c)=M$となって矛盾。
  以上より、$f'(c)=0$でなければならない。
\end{proof}

\begin{theorem}[平均値の定理]
  連続写像$f:[a,b]\to\mathbb{R}$が開区間$(a,b)$で微分可能とする。
  このとき、$c\in(a,b)$が存在して、
  \[
    \frac{f(b)-f(a)}{b-a}=f'(c)
  \]
  を満たす。
\end{theorem}
\begin{proof}
  \[
    g:[a,b]\to\mathbb{R};x\mapsto (b-a)(f(x)-f(a))-(x-a)(f(b)-f(a))
  \]
  を考えると、これは仮定より$[a,b]$上連続かつ$x\in(a,b)$で微分可能。
  また
  \[
    g(a)=g(b)=0
  \]
  ゆえ、ロルの定理より
  \[
    0=g'(c)=(b-a)f'(c)-(f(b)-f(a))
  \]
  となる$c\in(a,b)$が存在する。
  ゆえに
  \[
    f'(c)=\frac{f(b)-f(a)}{b-a}
  \]
\end{proof}

\begin{corollary}[合成関数の微分]
  $I,J$を区間、$u:I\to J$と$f:J\to\mathbb{R}$をそれぞれ可微分関数とする。
  さらに導関数$f':J\to\mathbb{R}$は連続でもあるとする。
  このとき、合成関数
  \[
    f\circ u:I\to\mathbb{R};x\mapsto f(u(x))
  \]
  も微分可能であり、
  \[
    (f\circ u)'(x)=f'(u(x))u'(x)
  \]
  が成り立つ。
\end{corollary}
\begin{proof}
  任意の$x\in I$と十分0に近い$h$をとる。
  証明は二つのケースに分けられる。

  まずある$x$の近傍が存在して、十分0に近い任意の$h$に対して$u(x)\neq u(x+h)$であるとする。
  以下では$u(x)<u(x+h)$であるとする($u(x)>u(x+h)$でも同様)。
  仮定より$f$は$[u(x),u(x+h)]\subset J$において連続かつ微分可能なため、平均値の定理より
  \[
    \frac{f(u(x+h))-f(u(x))}{u(x+h)-u(x)}=f'(c_h)
  \]
  を満たす$c_h\in[u(x),u(x+h)]$が存在する。
  よって
  \[
    \frac{f(u(x+h))-f(u(x))}{h}=f'(c_h)\frac{u(x+h)-u(x)}{h}
  \]
  $h\to0$のとき$c_h\in[u(x),u(x+h)]$であるから$c_h\to u(x)$。
  また仮定より$f'$は連続だったから、$f'(c_h)\to f'(u(x))$となる。
  さらに$u$は微分可能だったから、すべてまとめて
  \[
    (f\circ u)'(x)=\lim_{h\to0}\frac{f(u(x+h))-f(u(x))}{h}=\lim_{h\to0}\left\{f'(c_h)\frac{u(x+h)-u(x)}{h}\right\}=f'(u(x))u'(x)
  \]

  次に任意の$x$の近傍に対して、$u(x)=u(x+h)$となる$h\neq0$が存在するとする。
  このとき、
  \[
    \frac{f(u(x+h))-f(u(x))}{h}=\frac{f(u(x))-f(u(x))}{h}=0
  \]
  ゆえに$(f\circ u)'(x)=0$である。
  一方
  \[
    u'(x)=\lim_{h\to0}\frac{u(x+h)-u(x)}{h}=\lim_{h\to0}\frac{u(x)-u(x)}{h}=0
  \]
  が成り立つ\footnote{
    これが成り立つのは、大前提として$(u(x+h)-u(x))/h$の極限が存在するという仮定が含まれているからです。
    「任意の$x$の近傍に対して、どのような$h$をとっても$u(x)=u(x+h)$であるようなものが存在する」という仮定から、数列$h_n$であって、$h_n\to0$ ($n\to+\infty$)かつ、$u(x+h_n)=u(x)$ (${}^\forall n$)を満たすものが作れます。
    これについて、$u'(x)$は$(u(x+h_n)-u(x))/h_n=0$の$n\to+\infty$に関する極限に一致するというわけです。
  }。
  ゆえに与式は成り立つ。
\end{proof}

\begin{example}
  $n=p/q$を有理数とする($p\in\mathbb{Z}_{>0}$、$q\in\mathbb{Z}$)。
  このとき、
  \[
    f:(0,+\infty)\to\mathbb{R};x\mapsto x^n=x^{p/q}
  \]
  は可微分関数であり、
  \[
    (x^n)'=nx^{n-1}
  \]
  が成り立つ。
\end{example}
実際、$f$の定義から
\[
  f(x)^q=x^p
\]
なので、合成関数の微分から
\[
  qf(x)^{q-1}\cdot f'(x)=px^{p-1}\implies qx^{p-p/q}f'(x)=px^{p-1}
\]
よって、両辺を$qx^{p-p/q}$で割って
\[
  f'(x)=\frac{p}{q}x^{p-1-p+p/q}=nx^{n-1}
\]
